<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gate Pass Details</title>
  <style>
    body { font-family: Arial, sans-serif; }
    button { padding: 10px 20px; font-size: 14px; margin: 10px; cursor: pointer; }
  </style>
</head>
<body>
  <button id="downloadPdfBtn">Download Gate Pass PDF</button>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <script>
    // Dummy gatepass data
    const gatepass = {
      _id: "12345",
      createdAt: "2025-12-11T10:00:00Z",
      date: "2025-12-11",
      dispatchFrom: { hubName: "Dhaka Hub", details: "Address 1" },
      dispatchTo: { hubName: "Chittagong Hub", details: "Address 2" },
      sender: { name: "Alice", phone: "0123456789", designation: "Manager", employee_id: "EMP001", department: "Logistics" },
      receiver: { name: "Bob", phone: "0987654321", designation: "Supervisor", employee_id: "EMP002", department: "Warehouse" },
      preparedBy: { name: "Charlie", designation: "Admin", employee_id: "EMP003" },
      items: [
        { name: "Laptop", quantity: 5, unit: "pcs", comments: "Fragile" },
        { name: "Mouse", quantity: 10, unit: "pcs" }
      ],
      remarks: "Handle with care."
    };

    document.getElementById('downloadPdfBtn').addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      const pageWidth = doc.internal.pageSize.width;
      const margin = 10;
      let y = 15;

      // === Logo + Gate Pass ID ===
      doc.addImage('https://i.ibb.co.com/Df3S8Zhx/daraz-logo.png', 'PNG', margin, y, 30, 10);
      const gatePassId = `GATE PASS#: ${gatepass._id ? 'BD-IT' + new Date(gatepass.createdAt).toISOString().replace(/[-T:.]/g, '').slice(0,14) : 'N/A'}`;
      doc.setFontSize(12);
      doc.text(gatePassId, pageWidth - margin, y + 7, { align: 'right' });
      y += 15;

      // === Company Name ===
      doc.setFontSize(14);
      doc.setFont('helvetica', 'bold');
      doc.text('Daraz Bangladesh Limited', pageWidth/2, y, { align: 'center' });
      y += 10;

      // === Dates ===
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      const dispatchDate = `Dispatch Date: ${gatepass.date ? new Date(gatepass.date).toLocaleDateString('en-GB') : '____/____/____'}`;
      doc.text(dispatchDate, margin, y);
      doc.text('Receiving Date: _____________________', pageWidth - margin - 60, y);
      y += 10;
      doc.text('Challan Type: Internal/External', pageWidth/2, y, { align: 'center' });
      y += 12;

      // === Dispatch From / To ===
      doc.autoTable({
        startY: y,
        head: [['Dispatch From', 'Dispatch To']],
        body: [[
          `Name: ${gatepass.dispatchFrom?.hubName || 'N/A'}\nAddress: ${gatepass.dispatchFrom?.details || 'N/A'}`,
          `Name: ${gatepass.dispatchTo?.hubName || 'N/A'}\nAddress: ${gatepass.dispatchTo?.details || 'N/A'}`
        ]],
        theme: 'grid',
        headStyles: { fillColor: [220,220,220] },
        styles: { fontSize: 10, cellPadding: 3 }
      });
      y = doc.lastAutoTable.finalY + 5;

      // === Sender / Receiver ===
      doc.autoTable({
        startY: y,
        head: [`Sender's Details`, `Receiver's Details`],
        body: [[
          `Name: ${gatepass.sender?.name || 'N/A'}\nPhone: ${gatepass.sender?.phone || 'N/A'}\nDesignation: ${gatepass.sender?.designation || 'N/A'}\nEmployee ID: ${gatepass.sender?.employee_id || 'N/A'}\nDepartment: ${gatepass.sender?.department || 'N/A'}`,
          `Name: ${gatepass.receiver?.name || 'N/A'}\nPhone: ${gatepass.receiver?.phone || 'N/A'}\nDesignation: ${gatepass.receiver?.designation || 'N/A'}\nEmployee ID: ${gatepass.receiver?.employee_id || 'N/A'}\nDepartment: ${gatepass.receiver?.department || 'N/A'}`
        ]],
        theme: 'grid',
        headStyles: { fillColor: [220,220,220] },
        styles: { fontSize: 10, cellPadding: 3 }
      });
      y = doc.lastAutoTable.finalY + 5;

      // === Items Table ===
      const items = (gatepass.items || []).map((item,i) => [i+1, item.name || '', item.quantity || '', item.unit || '']);
      while(items.length<5) items.push([items.length+1,'','','']);
      doc.autoTable({
        startY: y,
        head: [['SL NO', 'ITEM DESCRIPTION', 'QUANTITY', 'UNIT']],
        body: items,
        theme: 'grid',
        headStyles: { fillColor: [220,220,220] },
        styles: { fontSize: 10, cellPadding: 2 }
      });
      y = doc.lastAutoTable.finalY + 5;

      // === Remarks ===
      doc.text('Remarks:', margin, y);
      y += 5;
      doc.rect(margin, y, pageWidth - 2*margin, 25);
      if(gatepass.remarks){
        const split = doc.splitTextToSize(gatepass.remarks, pageWidth - 2*margin -4);
        doc.text(split, margin+2, y+4);
      }
      y += 30;

      // === Prepared By ===
      const pb = gatepass.preparedBy || {};
      doc.autoTable({
        startY: y,
        head: ['Prepared By'],
        body: [[
          `Name: ${pb.name || 'N/A'}\nDesignation: ${pb.designation || 'N/A'}\nEmployee ID: ${pb.employee_id || 'N/A'}\nSign: ${(pb.name || '').toLowerCase()}`
        ]],
        theme: 'grid',
        headStyles: { fillColor: [220,220,220] },
        styles: { fontSize: 10, cellPadding: 3 }
      });
      y = doc.lastAutoTable.finalY + 5;

      // === Signature Blocks ===
      doc.autoTable({
        startY: y,
        head: [['PREPARED BY','SECURITY CHECK','RECEIVED BY']],
        body: [['','','']],
        theme: 'grid',
        headStyles: { fillColor: [240,240,240] },
        bodyStyles: { minCellHeight: 20 },
        styles: { fontSize: 10 }
      });

      // === Footer ===
      doc.setFontSize(9);
      doc.text('Daraz Internal B2 DR-COMP-FRM-GPFRM  28 December, 2025  Version 1.1', pageWidth/2, 287, { align:'center' });

      // === Save PDF ===
      doc.save(`GatePass_${gatepass._id || Date.now()}.pdf`);
    });
  </script>
</body>
</html>
